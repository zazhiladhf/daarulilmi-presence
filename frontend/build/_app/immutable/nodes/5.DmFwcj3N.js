import"../chunks/DsnmJJEf.js";import"../chunks/DlWC4716.js";import{o as at,h as tt,e as N,s as o}from"../chunks/C-cUeD8I.js";import{p as et,b as l,f as m,t as b,a as d,e as rt,$ as st,s as i,d as t,h as e,m as aa,n as Da,r as a,g as _,c as T}from"../chunks/DVhLo0Kx.js";import{i as u}from"../chunks/Bj3ioQdl.js";import{e as it,i as dt}from"../chunks/Bt5UU4cX.js";import{i as nt}from"../chunks/CSakOhqG.js";var ot=l('<h1 class="h2"> </h1>'),lt=l('<h1 class="h2">Memuat...</h1>'),vt=l("<p>Memuat data dashboard...</p>"),ct=l('<div class="alert alert-danger"> </div>'),bt=l('<div class="alert alert-info text-center"><h4 class="alert-heading"><i class="bi bi-calendar-heart"></i> Hari Libur</h4> <p> </p></div>'),ut=l('<span class="badge bg-success"> </span>'),ht=l('<span class="badge bg-warning text-dark"> </span>'),mt=l('<span class="badge bg-danger"> </span>'),_t=l('<span class="badge bg-secondary"> </span>'),pt=l('<tr><td> </td><td> </td><td><!></td><td> </td><td class="text-center"><div class="btn-group btn-group-sm" role="group"><button class="btn btn-outline-success" title="Set Hadir">H</button> <button class="btn btn-outline-warning" title="Set Sakit">S</button> <button class="btn btn-outline-info" title="Set Izin">I</button> <button class="btn btn-outline-danger" title="Set Alpa">A</button></div></td></tr>'),ft=l('<tr><td colspan="5" class="text-center">Data siswa tidak ditemukan.</td></tr>'),gt=l('<div class="row"><div class="col-lg-3 mb-3"><div class="card bg-primary text-white"><div class="card-body"><h5 class="card-title">Total Siswa</h5><p class="card-text fs-2 fw-bold"> </p></div></div></div> <div class="col-lg-3 mb-3"><div class="card bg-success text-white"><div class="card-body"><h5 class="card-title">Hadir</h5><p class="card-text fs-2 fw-bold"> </p></div></div></div> <div class="col-lg-3 mb-3"><div class="card bg-warning text-dark"><div class="card-body"><h5 class="card-title">Izin/Sakit</h5><p class="card-text fs-2 fw-bold"> </p></div></div></div> <div class="col-lg-3 mb-3"><div class="card bg-secondary text-white"><div class="card-body"><h5 class="card-title">Belum Ada Kabar</h5><p class="card-text fs-2 fw-bold"> </p></div></div></div></div> <div class="card mt-3 shadow-sm"><div class="card-header"><h5><i class="bi bi-list-task"></i> Status Kehadiran Seluruh Siswa Hari Ini</h5></div> <div class="card-body"><div class="table-responsive"><table class="table table-striped table-hover"><thead><tr><th>NISN</th><th>Nama Lengkap</th><th>Status</th><th>Keterangan</th><th class="text-center">Aksi Manual</th></tr></thead><tbody></tbody></table></div></div></div>',1),kt=l('<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom"><div><!> <p class="text-muted" id="live-datetime">Memuat waktu...</p></div> <div class="btn-toolbar mb-2 mb-md-0"><button class="btn btn-sm btn-outline-secondary"><i class="bi bi-arrow-clockwise"></i> Refresh</button> <a href="/dashboard/kehadiran/tambah" class="btn btn-sm btn-outline-primary ms-2"><i class="bi bi-calendar-plus"></i> Catat Absensi Lalu</a></div></div> <!>',1);function Ht(Ha,za){et(za,!1);let v=aa(null),H=aa(""),z=aa(!0),j="";async function ta(){if(_(z,!0),_(H,""),!j){_(z,!1),_(H,"Sesi Anda telah berakhir. Silakan login kembali.");return}try{const r=await fetch(`http://localhost:1412/api/dashboard-data?t=${new Date().getTime()}`,{headers:{Authorization:"Bearer "+j},cache:"no-store"});if(r.status===401)throw localStorage.removeItem("jwt_token"),window.location.href="/",new Error("Sesi tidak valid. Harap login kembali.");if(!r.ok)throw new Error("Gagal memuat data dashboard dari server.");_(v,await r.json())}catch(r){_(H,r.message),console.error("Fetch error:",r)}finally{_(z,!1)}}async function M(r,n){if(confirm(`Anda yakin ingin mengubah status NISN ${r} menjadi "${n}"?`))try{const c=await fetch("http://localhost:1412/api/absensi/manual",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+j},body:JSON.stringify({NISN:r,Status:n})}),p=await c.json();if(!c.ok)throw new Error(p.message);alert(p.message),window.location.reload()}catch(c){alert(`Error: ${c.message}`)}}at(()=>{{j=localStorage.getItem("jwt_token")||"",ta();const r=document.getElementById("live-datetime");if(r){const n=setInterval(()=>{const c=new Date,p=c.toLocaleDateString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),K=c.toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit",second:"2-digit"});r.innerText=`Waktu Saat Ini: ${p} pukul ${K}`},1e3);return()=>clearInterval(n)}}}),nt();var ea=kt();tt(r=>{st.title="Dashboard Kehadiran"});var E=m(ea),B=t(E),La=t(B);{var Na=r=>{var n=ot(),c=t(n);a(n),b(()=>o(c,`Selamat Datang, ${e(v).namaLengkapUser??""}!`)),d(r,n)},Ta=r=>{var n=lt();d(r,n)};u(La,r=>{e(v)?r(Na):r(Ta,!1)})}Da(2),a(B);var ra=i(B,2),sa=t(ra);Da(2),a(ra),a(E);var ja=i(E,2);{var Ma=r=>{var n=vt();d(r,n)},Ea=r=>{var n=T(),c=m(n);{var p=f=>{var g=ct(),C=t(g,!0);a(g),b(()=>o(C,e(H))),d(f,g)},K=f=>{var g=T(),C=m(g);{var Ba=O=>{var ia=T(),Ka=m(ia);{var Ca=k=>{var x=bt(),S=i(t(x),2),L=t(S);a(S),a(x),b(()=>o(L,`${e(v).holidayDescription??""}. Tidak ada pencatatan absensi hari ini.`)),d(k,x)},Oa=k=>{var x=gt(),S=m(x),L=t(S),da=t(L),na=t(da),oa=i(t(na)),Fa=t(oa,!0);a(oa),a(na),a(da),a(L);var F=i(L,2),la=t(F),va=t(la),ca=i(t(va)),Ga=t(ca,!0);a(ca),a(va),a(la),a(F);var G=i(F,2),ba=t(G),ua=t(ba),ha=i(t(ua)),Ja=t(ha,!0);a(ha),a(ua),a(ba),a(G);var ma=i(G,2),_a=t(ma),pa=t(_a),fa=i(t(pa)),Pa=t(fa,!0);a(fa),a(pa),a(_a),a(ma),a(S);var ga=i(S,2),ka=i(t(ga),2),xa=t(ka),Sa=t(xa),ya=i(t(Sa));it(ya,5,()=>e(v).daftarStatusSiswa,dt,(J,s)=>{var P=pt(),R=t(P),Ra=t(R,!0);a(R);var U=i(R),Ua=t(U,!0);a(U);var W=i(U),Wa=t(W);{var qa=y=>{var w=ut(),Y=t(w,!0);a(w),b(()=>o(Y,e(s).status)),d(y,w)},Qa=y=>{var w=T(),Y=m(w);{var Xa=I=>{var A=ht(),Z=t(A,!0);a(A),b(()=>o(Z,e(s).status)),d(I,A)},Ya=I=>{var A=T(),Z=m(A);{var Za=D=>{var h=mt(),$=t(h,!0);a(h),b(()=>o($,e(s).status)),d(D,h)},$a=D=>{var h=_t(),$=t(h,!0);a(h),b(()=>o($,e(s).status)),d(D,h)};u(Z,D=>{e(s).status==="Alpa"?D(Za):D($a,!1)},!0)}d(I,A)};u(Y,I=>{e(s).status==="Sakit"||e(s).status==="Izin"?I(Xa):I(Ya,!1)},!0)}d(y,w)};u(Wa,y=>{e(s).status==="Hadir"?y(qa):y(Qa,!1)})}a(W);var q=i(W),Va=t(q,!0);a(q);var wa=i(q),Ia=t(wa),Q=t(Ia),V=i(Q,2),X=i(V,2),Aa=i(X,2);a(Ia),a(wa),a(P),b(()=>{o(Ra,e(s).nisn),o(Ua,e(s).namaLengkap),o(Va,e(s).keterangan),Q.disabled=e(s).status==="Hadir",V.disabled=e(s).status==="Sakit",X.disabled=e(s).status==="Izin",Aa.disabled=e(s).status==="Alpa"}),N("click",Q,()=>M(e(s).nisn,"Hadir")),N("click",V,()=>M(e(s).nisn,"Sakit")),N("click",X,()=>M(e(s).nisn,"Izin")),N("click",Aa,()=>M(e(s).nisn,"Alpa")),d(J,P)},J=>{var s=ft();d(J,s)}),a(ya),a(Sa),a(xa),a(ka),a(ga),b(()=>{o(Fa,e(v).totalSiswa),o(Ga,e(v).totalHadir),o(Ja,e(v).totalIzin),o(Pa,e(v).totalBelumAdaKabar)}),d(k,x)};u(Ka,k=>{e(v).isHoliday?k(Ca):k(Oa,!1)})}d(O,ia)};u(C,O=>{e(v)&&O(Ba)},!0)}d(f,g)};u(c,f=>{e(H)?f(p):f(K,!1)},!0)}d(r,n)};u(ja,r=>{e(z)?r(Ma):r(Ea,!1)})}b(()=>sa.disabled=e(z)),N("click",sa,ta),d(Ha,ea),rt()}export{Ht as component};

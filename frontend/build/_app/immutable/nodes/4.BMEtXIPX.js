import"../chunks/DsnmJJEf.js";import"../chunks/DlWC4716.js";import{o as N,h as z,e as A,s as F}from"../chunks/C-cUeD8I.js";import{p as H,b as w,t as q,h as o,a as m,e as K,$ as Q,s as n,d as r,g as s,m as v,r as t,n as V,i as W}from"../chunks/DVhLo0Kx.js";import{i as D}from"../chunks/Bj3ioQdl.js";import{r as E}from"../chunks/BMwGc5xt.js";import{b as O}from"../chunks/CbjkAijc.js";import{p as X}from"../chunks/D4Caz1gY.js";import{i as Y}from"../chunks/CSakOhqG.js";import{g as h}from"../chunks/Fs8NSvnN.js";var Z=w('<div class="alert alert-danger" role="alert"> </div>'),aa=w('<span class="spinner-border spinner-border-sm"></span> Loading...',1),ea=w('<div class="bg-light"><div class="container"><div class="row justify-content-center align-items-center" style="min-height: 100vh;"><div class="col-md-5 col-lg-4"><div class="card shadow-sm"><div class="card-body p-4"><h3 class="card-title text-center mb-4">Smart Presence Login</h3> <!> <form><div class="mb-3"><label for="username" class="form-label">Username</label> <input type="text" class="form-control" id="username" required/></div> <div class="mb-3"><label for="password" class="form-label">Password</label> <input type="password" class="form-control" id="password" required/></div> <div class="d-grid mt-4"><button type="submit" class="btn btn-primary"><!></button></div></form></div></div></div></div></div></div>');function ca(R,U){H(U,!1);let c=v(""),p=v(""),i=v(""),d=v(!1);N(()=>{{const a=localStorage.getItem("jwt_token");a&&k(a)}});function k(a){try{const l=JSON.parse(atob(a.split(".")[1])).role;l==="admin"?h("/dashboard"):l==="siswa"?h("/scan"):l==="ortu"?h("/portal"):(s(i,"Peran pengguna tidak dikenali."),localStorage.removeItem("jwt_token"))}catch(e){console.error("Gagal mendekode token:",e),s(i,"Token tidak valid, silakan login kembali."),localStorage.removeItem("jwt_token")}}async function $(){s(d,!0),s(i,"");try{const a=await fetch("http://localhost:1412/login",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({username:o(c),password:o(p)})}),e=await a.json();if(!a.ok)throw new Error(e.message||"Login gagal.");if(e.token)localStorage.setItem("jwt_token",e.token),k(e.token);else throw new Error("Token tidak diterima dari server.")}catch(a){s(i,a.message)}finally{s(d,!1)}}Y();var f=ea();z(a=>{Q.title="Login - DI Smart Presence"});var y=r(f),x=r(y),S=r(x),L=r(S),j=r(L),P=n(r(j),2);{var B=a=>{var e=Z(),l=r(e,!0);t(e),q(()=>F(l,o(i))),m(a,e)};D(P,a=>{o(i)&&a(B)})}var g=n(P,2),u=r(g),I=n(r(u),2);E(I),t(u);var b=n(u,2),T=n(r(b),2);E(T),t(b);var M=n(b,2),_=r(M),C=r(_);{var G=a=>{var e=aa();V(),m(a,e)},J=a=>{var e=W("Masuk");m(a,e)};D(C,a=>{o(d)?a(G):a(J,!1)})}t(_),t(M),t(g),t(j),t(L),t(S),t(x),t(y),t(f),q(()=>_.disabled=o(d)),O(I,()=>o(c),a=>s(c,a)),O(T,()=>o(p),a=>s(p,a)),A("submit",g,X($)),m(R,f),K()}export{ca as component};

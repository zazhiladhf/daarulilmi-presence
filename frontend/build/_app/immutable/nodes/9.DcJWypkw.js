import"../chunks/DsnmJJEf.js";import"../chunks/DlWC4716.js";import{o as ma,h as ca,e as pa,s as O}from"../chunks/C-cUeD8I.js";import{p as fa,m as p,b as m,s as n,f as C,h as e,a as d,e as ba,$ as _a,d as i,g as o,o as U,r as s,t as _,c as ha,k as ua,n as V}from"../chunks/DVhLo0Kx.js";import{i as h}from"../chunks/Bj3ioQdl.js";import{e as ga}from"../chunks/Bt5UU4cX.js";import{r as wa}from"../chunks/BMwGc5xt.js";import{b as ya}from"../chunks/CbjkAijc.js";import{b as Sa}from"../chunks/B93iMbHO.js";import{p as ka}from"../chunks/D4Caz1gY.js";import{i as xa}from"../chunks/CSakOhqG.js";import{g as Ma}from"../chunks/Fs8NSvnN.js";var Ta=m('<div class="alert alert-danger"> </div>'),ja=m('<div class="alert alert-success"> </div>'),Aa=m("<p>Memuat daftar siswa...</p>"),Ia=m('<tr><td class="align-middle"> </td><td><select class="form-select"><option>Hadir</option><option>Sakit</option><option>Izin</option><option>Alpa</option></select></td></tr>'),Ka=m('<span class="spinner-border spinner-border-sm"></span> Menyimpan...',1),za=m('<i class="bi bi-save"></i> Simpan Semua Kehadiran',1),Da=m('<div class="table-responsive"><table class="table"><thead><tr><th>Nama Siswa</th><th>Status Kehadiran</th></tr></thead><tbody></tbody></table></div> <button type="submit" class="btn btn-primary"><!></button>',1),Ea=m(`<div class="alert alert-warning">Tidak ada data siswa yang bisa ditampilkan. Pastikan data di sheet 'DataSiswa' sudah benar.</div>`),Na=m('<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom"><h1 class="h2">Catat Kehadiran Massal</h1> <a href="/dashboard/kehadiran" class="btn btn-sm btn-outline-secondary"><i class="bi bi-arrow-left"></i> Kembali</a></div> <div class="card shadow-sm"><div class="card-body"><!> <!> <form><div class="row mb-3"><div class="col-md-4"><label for="tanggal" class="form-label fw-bold">Pilih Tanggal Absensi:</label> <input type="date" class="form-control" id="tanggal" required/></div></div> <!></form></div></div>',1);function Ra(W,X){fa(X,!1);let S="",u=p([]),c=p({}),k=p(new Date().toISOString().split("T")[0]),x=p(!0),g=p(!1),f=p(""),w=p("");ma(async()=>{{S=localStorage.getItem("jwt_token")||"",o(x,!0),o(f,"");try{console.log("Mencoba mengambil daftar siswa...");const a=await fetch("http://localhost:1412/api/siswa",{headers:{Authorization:"Bearer "+S}});if(!a.ok)throw new Error("Gagal mengambil daftar siswa dari server.");const t=await a.json();console.log("Data siswa diterima dari backend:",t),o(u,t.filter(r=>r&&r.nisn)),e(u).forEach(r=>{U(c,e(c)[r.nisn]="Hadir")})}catch(a){console.error("Fetch Error:",a),o(f,a.message)}finally{o(x,!1)}}});async function Y(){o(g,!0),o(f,""),o(w,"");const a=Object.entries(e(c)).map(([t,r])=>({NISN:t,Status:r,Timestamp:`${e(k)} 07:00:00`}));try{const t=await fetch("http://localhost:1412/api/absensi/manual/batch",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+S},body:JSON.stringify(a)}),r=await t.json();if(!t.ok)throw new Error(r.message);o(w,r.message),setTimeout(()=>{Ma("/dashboard/kehadiran")},2e3)}catch(t){o(f,t.message)}finally{o(g,!1)}}xa();var H=Na();ca(a=>{_a.title="Catat Kehadiran Massal"});var L=n(C(H),2),P=i(L),B=i(P);{var Z=a=>{var t=Ta(),r=i(t,!0);s(t),_(()=>O(r,e(f))),d(a,t)};h(B,a=>{e(f)&&a(Z)})}var q=n(B,2);{var aa=a=>{var t=ja(),r=i(t,!0);s(t),_(()=>O(r,e(w))),d(a,t)};h(q,a=>{e(w)&&a(aa)})}var M=n(q,2),T=i(M),F=i(T),G=n(i(F),2);wa(G),s(F),s(T);var ta=n(T,2);{var ea=a=>{var t=Aa();d(a,t)},ra=a=>{var t=ha(),r=C(t);{var sa=b=>{var y=Da(),j=C(y),J=i(j),$=n(i(J));ga($,5,()=>e(u),l=>l.nisn,(l,v)=>{var I=Ia(),K=i(I),da=i(K);s(K);var Q=n(K),z=i(Q);_(()=>{e(c),ua(()=>{e(v)})});var D=i(z);D.value=D.__value="Hadir";var E=n(D);E.value=E.__value="Sakit";var N=n(E);N.value=N.__value="Izin";var R=n(N);R.value=R.__value="Alpa",s(z),s(Q),s(I),_(()=>O(da,`${e(v).namaLengkap??""} (${e(v).nisn??""})`)),Sa(z,()=>e(c)[e(v).nisn],va=>U(c,e(c)[e(v).nisn]=va)),d(l,I)}),s($),s(J),s(j);var A=n(j,2),oa=i(A);{var na=l=>{var v=Ka();V(),d(l,v)},la=l=>{var v=za();V(),d(l,v)};h(oa,l=>{e(g)?l(na):l(la,!1)})}s(A),_(()=>A.disabled=e(g)),d(b,y)},ia=b=>{var y=Ea();d(b,y)};h(r,b=>{e(u).length>0?b(sa):b(ia,!1)},!0)}d(a,t)};h(ta,a=>{e(x)?a(ea):a(ra,!1)})}s(M),s(P),s(L),ya(G,()=>e(k),a=>o(k,a)),pa("submit",M,ka(Y)),d(W,H),ba()}export{Ra as component};
